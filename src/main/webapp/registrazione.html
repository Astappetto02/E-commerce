<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="css/style.css" type="text/css">
  <title>Tren Nutrition</title>
  <script type="text/javascript">
    function validateForm(){
      let email = document.getElementById("email").value;
      let password = document.getElementById("password").value;
      let emailPattern = /^([a-z0-9_\.-]+@[a-z\d\.-]+\.[a-z\.]{2,6})$/;
      let passwordPattern = /^(?=.*\d)(?=.*[A-Z])(?=.*[a-z])(?=.*[^\w\d\s:])([^\s]){8,16}$/;

      if (!emailPattern.test(email)) {
        alert("Email non valida");
        return false;
      }else{
          if(!ajaxValidate()){
            return false;
          }
      }

      if (!passwordPattern.test(password)) {
        alert("La password deve contenere almeno 1 numero, 1 carattere maiuscolo, 1 minuscolo, 1 carattere non alfanumerico e non deve contenere spazi");
        return false;
      }

      return true;
    }
    function ajaxValidate(email){
      let xml = new XMLHttpRequest();
      xml.onreadystatechange = function(){
        if(this.readyState == 4 && this.status==200){
          if(this.responseText ==="invalid"){
            alert("L'email &egrave; già associata ad un account")
            return false
          }else {
            return true
          }
        }
      }
      xml.open("GET","check?email="+email,true);
      xml.send();
    }
    function passwordToggle(){
      let password = document.getElementById("password");
      let icon = document.getElementById("showpassword");
      if(password.type==="password"){
        password.type="text";
        icon.className = "fa-regular fa-eye";
      }else{
        password.type="password";
        icon.className = "fa-regular fa-eye-slash";
      }
    }
  </script>

</head>

<body>
<section id="header">
  <a href="http://localhost:8080/Gisolfi_Merola_pj_war_exploded/"><img src="img/Logo.png" class="logo"></a>
  <div class="search-bar">
    <input type="text" placeholder="Cerca...">
    <button type="submit"><i class="fas fa-search"></i></button>
  </div>
  <div>
    <ul id="navbar">
      <li><a href="http://localhost:8080/Gisolfi_Merola_pj_war_exploded/">Home</a></li>
      <li><a href="http://localhost:8080/Gisolfi_Merola_pj_war_exploded/ChiSiamo.jsp">Chi siamo</a></li>
      <li><a href="http://localhost:8080/Gisolfi_Merola_pj_war_exploded/categorie.jsp">Prodotti</a></li>
      <li><a href="http://localhost:8080/Gisolfi_Merola_pj_war_exploded/carrello"><i class="fas fa-shopping-cart"></i></a></li>
      <li><a href="http://localhost:8080/Gisolfi_Merola_pj_war_exploded/account.jsp"><i class="far fa-user"></i></a></li>
    </ul>
  </div>
</section>

<main>
  <section class="section-registration">
    <div class="form-container">
      <div class="form-box-registration">
        <form onsubmit="return validateForm()" action="Registrazione" method="post" autocomplete="off">
          <h1>CREA UN ACCOUNT</h1>
          <div class="input-box-registration">
            <label><b>Nome</b></label>
            <input type="text" name="nome">
          </div>
          <div class="input-box-registration">
            <label><b>Cognome</b></label>
            <input type="text" name="cognome">
          </div>
          <div class="input-box-registration">
            <label><b>Username</b></label>
            <input type="text" name="username">
          </div>
          <div class="input-box-registration">
            <label><b>Email</b></label>
            <input type="email" name="email" id="email">
          </div>
          <div class="input-box-registration">
            <label><b>Password</b></label>
            <input type="password" name="password" id="password"><i id="showpassword"class="fa-regular fa-eye-slash" onclick="passwordToggle()"></i></input>
          </div>
          <div class="input-box-registration">
            <label><b>Telefono</b></label>
            <input type="text" name="telefono">
          </div>
          <fieldset>
            <div class="input-box-registration">
              <legend><b>Indirizzo</b></legend>
              <label><b>Via</b></label>
              <input type="text" name="via">
            </div>
            <div class="input-box-registration">
              <label><b>N. Civico</b></label>
              <input type="text" name="civico">
            </div>
            <div class="input-box-registration">
              <label><b>CAP</b></label>
              <input type="text" name="cap">
            </div>
          </fieldset>
          <button type="submit" value="Registrati">Registrati</button>
        </form>
      </div>
    </div>
  </section>
</main>


<footer>
  <!-- Il piè di pagina va qui -->
</footer>
</body>

</html>